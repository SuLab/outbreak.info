import axios from "axios";
import { from, forkJoin, BehaviorSubject } from "rxjs";
import { finalize, catchError, pluck, map, mergeMap } from "rxjs/operators";
import {
  timeParse,
  timeFormat
} from "d3";
import { rollingAverage } from "@/js/stats.js";

// reminder: must be the raw verison of the file
const curatedFile = "https://raw.githubusercontent.com/andersen-lab/hCoV19-sitrep/master/curated_mutations.json";

const b117_global = [{"term":"2020-09-20","count":1},{"term":"2020-09-21","count":1},{"term":"2020-09-23","count":1},{"term":"2020-09-30","count":2},{"term":"2020-10-01","count":1},{"term":"2020-10-08","count":1},{"term":"2020-10-11","count":3},{"term":"2020-10-15","count":3},{"term":"2020-10-21","count":14},{"term":"2020-10-22","count":7},{"term":"2020-10-23","count":3},{"term":"2020-10-24","count":5},{"term":"2020-10-25","count":1},{"term":"2020-10-26","count":2},{"term":"2020-10-29","count":18},{"term":"2020-10-30","count":8},{"term":"2020-10-31","count":4},{"term":"2020-11-01","count":39},{"term":"2020-11-02","count":48},{"term":"2020-11-03","count":7},{"term":"2020-11-04","count":4},{"term":"2020-11-05","count":86},{"term":"2020-11-06","count":31},{"term":"2020-11-07","count":1},{"term":"2020-11-08","count":104},{"term":"2020-11-09","count":47},{"term":"2020-11-10","count":18},{"term":"2020-11-11","count":45},{"term":"2020-11-12","count":148},{"term":"2020-11-13","count":182},{"term":"2020-11-14","count":133},{"term":"2020-11-15","count":90},{"term":"2020-11-16","count":11},{"term":"2020-11-17","count":103},{"term":"2020-11-18","count":97},{"term":"2020-11-19","count":60},{"term":"2020-11-20","count":35},{"term":"2020-11-21","count":115},{"term":"2020-11-22","count":263},{"term":"2020-11-23","count":38},{"term":"2020-11-24","count":33},{"term":"2020-11-25","count":13},{"term":"2020-11-26","count":101},{"term":"2020-11-27","count":94},{"term":"2020-11-28","count":77},{"term":"2020-11-29","count":57},{"term":"2020-11-30","count":51},{"term":"2020-12-01","count":31},{"term":"2020-12-02","count":62},{"term":"2020-12-03","count":56},{"term":"2020-12-04","count":176},{"term":"2020-12-05","count":98},{"term":"2020-12-06","count":60},{"term":"2020-12-07","count":306},{"term":"2020-12-08","count":225},{"term":"2020-12-09","count":195},{"term":"2020-12-10","count":998},{"term":"2020-12-11","count":392},{"term":"2020-12-12","count":303},{"term":"2020-12-13","count":571},{"term":"2020-12-14","count":715},{"term":"2020-12-15","count":722},{"term":"2020-12-16","count":766},{"term":"2020-12-17","count":956},{"term":"2020-12-18","count":997},{"term":"2020-12-19","count":527},{"term":"2020-12-20","count":470},{"term":"2020-12-21","count":708},{"term":"2020-12-22","count":384},{"term":"2020-12-23","count":349},{"term":"2020-12-24","count":407},{"term":"2020-12-25","count":248},{"term":"2020-12-26","count":834},{"term":"2020-12-27","count":585},{"term":"2020-12-28","count":576},{"term":"2020-12-29","count":1164},{"term":"2020-12-30","count":645},{"term":"2020-12-31","count":785},{"term":"2021-01-01","count":377},{"term":"2021-01-02","count":1352},{"term":"2021-01-03","count":987},{"term":"2021-01-04","count":1072},{"term":"2021-01-05","count":782},{"term":"2021-01-06","count":380},{"term":"2021-01-07","count":364},{"term":"2021-01-08","count":667},{"term":"2021-01-09","count":795},{"term":"2021-01-10","count":317},{"term":"2021-01-11","count":183},{"term":"2021-01-12","count":27},{"term":"2021-01-13","count":8},{"term":"2021-01-14","count":1},{"term":"2021-01-15","count":1},{"term":"2021-01-16","count":1}];

const b117_us = [{"term":"2020-12-18","count":1},{"term":"2020-12-19","count":1},{"term":"2020-12-20","count":4},{"term":"2020-12-21","count":1},{"term":"2020-12-24","count":3},{"term":"2020-12-26","count":14},{"term":"2020-12-27","count":5},{"term":"2020-12-28","count":13},{"term":"2020-12-29","count":18},{"term":"2020-12-30","count":13},{"term":"2020-12-31","count":21},{"term":"2021-01-02","count":12},{"term":"2021-01-03","count":9},{"term":"2021-01-04","count":21},{"term":"2021-01-05","count":23},{"term":"2021-01-06","count":13},{"term":"2021-01-07","count":11},{"term":"2021-01-08","count":3},{"term":"2021-01-09","count":1}];

const all_global = [{"term":"2019-12-24","count":1},{"term":"2019-12-26","count":1},{"term":"2019-12-30","count":12},{"term":"2019-12-31","count":1},{"term":"2020-01-01","count":2},{"term":"2020-01-03","count":1},{"term":"2020-01-05","count":2},{"term":"2020-01-06","count":1},{"term":"2020-01-08","count":2},{"term":"2020-01-10","count":2},{"term":"2020-01-11","count":3},{"term":"2020-01-13","count":3},{"term":"2020-01-14","count":1},{"term":"2020-01-15","count":4},{"term":"2020-01-16","count":3},{"term":"2020-01-17","count":4},{"term":"2020-01-18","count":7},{"term":"2020-01-19","count":4},{"term":"2020-01-20","count":8},{"term":"2020-01-21","count":12},{"term":"2020-01-22","count":40},{"term":"2020-01-23","count":26},{"term":"2020-01-24","count":29},{"term":"2020-01-25","count":44},{"term":"2020-01-26","count":45},{"term":"2020-01-27","count":31},{"term":"2020-01-28","count":30},{"term":"2020-01-29","count":56},{"term":"2020-01-30","count":58},{"term":"2020-01-31","count":28},{"term":"2020-02-01","count":44},{"term":"2020-02-02","count":33},{"term":"2020-02-03","count":31},{"term":"2020-02-04","count":23},{"term":"2020-02-05","count":35},{"term":"2020-02-06","count":23},{"term":"2020-02-07","count":27},{"term":"2020-02-08","count":36},{"term":"2020-02-09","count":28},{"term":"2020-02-10","count":23},{"term":"2020-02-11","count":19},{"term":"2020-02-12","count":10},{"term":"2020-02-13","count":16},{"term":"2020-02-14","count":12},{"term":"2020-02-15","count":34},{"term":"2020-02-16","count":33},{"term":"2020-02-17","count":52},{"term":"2020-02-18","count":19},{"term":"2020-02-19","count":25},{"term":"2020-02-20","count":35},{"term":"2020-02-21","count":53},{"term":"2020-02-22","count":38},{"term":"2020-02-23","count":32},{"term":"2020-02-24","count":58},{"term":"2020-02-25","count":54},{"term":"2020-02-26","count":68},{"term":"2020-02-27","count":93},{"term":"2020-02-28","count":161},{"term":"2020-02-29","count":124},{"term":"2020-03-01","count":198},{"term":"2020-03-02","count":320},{"term":"2020-03-03","count":370},{"term":"2020-03-04","count":444},{"term":"2020-03-05","count":448},{"term":"2020-03-06","count":441},{"term":"2020-03-07","count":411},{"term":"2020-03-08","count":429},{"term":"2020-03-09","count":903},{"term":"2020-03-10","count":826},{"term":"2020-03-11","count":960},{"term":"2020-03-12","count":1165},{"term":"2020-03-13","count":1304},{"term":"2020-03-14","count":1261},{"term":"2020-03-15","count":1474},{"term":"2020-03-16","count":2058},{"term":"2020-03-17","count":2048},{"term":"2020-03-18","count":2139},{"term":"2020-03-19","count":1873},{"term":"2020-03-20","count":1912},{"term":"2020-03-21","count":1612},{"term":"2020-03-22","count":1613},{"term":"2020-03-23","count":2405},{"term":"2020-03-24","count":2375},{"term":"2020-03-25","count":2310},{"term":"2020-03-26","count":2402},{"term":"2020-03-27","count":2451},{"term":"2020-03-28","count":1991},{"term":"2020-03-29","count":1659},{"term":"2020-03-30","count":2606},{"term":"2020-03-31","count":2401},{"term":"2020-04-01","count":2437},{"term":"2020-04-02","count":2008},{"term":"2020-04-03","count":2081},{"term":"2020-04-04","count":1502},{"term":"2020-04-05","count":1256},{"term":"2020-04-06","count":2117},{"term":"2020-04-07","count":1856},{"term":"2020-04-08","count":1758},{"term":"2020-04-09","count":1466},{"term":"2020-04-10","count":1478},{"term":"2020-04-11","count":1271},{"term":"2020-04-12","count":1003},{"term":"2020-04-13","count":1763},{"term":"2020-04-14","count":1583},{"term":"2020-04-15","count":1483},{"term":"2020-04-16","count":1468},{"term":"2020-04-17","count":1381},{"term":"2020-04-18","count":953},{"term":"2020-04-19","count":748},{"term":"2020-04-20","count":1616},{"term":"2020-04-21","count":1330},{"term":"2020-04-22","count":1300},{"term":"2020-04-23","count":1212},{"term":"2020-04-24","count":1122},{"term":"2020-04-25","count":751},{"term":"2020-04-26","count":660},{"term":"2020-04-27","count":1265},{"term":"2020-04-28","count":1066},{"term":"2020-04-29","count":1273},{"term":"2020-04-30","count":1242},{"term":"2020-05-01","count":1083},{"term":"2020-05-02","count":711},{"term":"2020-05-03","count":548},{"term":"2020-05-04","count":1102},{"term":"2020-05-05","count":865},{"term":"2020-05-06","count":818},{"term":"2020-05-07","count":828},{"term":"2020-05-08","count":752},{"term":"2020-05-09","count":564},{"term":"2020-05-10","count":446},{"term":"2020-05-11","count":875},{"term":"2020-05-12","count":843},{"term":"2020-05-13","count":884},{"term":"2020-05-14","count":985},{"term":"2020-05-15","count":978},{"term":"2020-05-16","count":490},{"term":"2020-05-17","count":457},{"term":"2020-05-18","count":1114},{"term":"2020-05-19","count":926},{"term":"2020-05-20","count":671},{"term":"2020-05-21","count":637},{"term":"2020-05-22","count":664},{"term":"2020-05-23","count":358},{"term":"2020-05-24","count":344},{"term":"2020-05-25","count":576},{"term":"2020-05-26","count":680},{"term":"2020-05-27","count":662},{"term":"2020-05-28","count":489},{"term":"2020-05-29","count":475},{"term":"2020-05-30","count":322},{"term":"2020-05-31","count":294},{"term":"2020-06-01","count":706},{"term":"2020-06-02","count":663},{"term":"2020-06-03","count":547},{"term":"2020-06-04","count":563},{"term":"2020-06-05","count":506},{"term":"2020-06-06","count":286},{"term":"2020-06-07","count":423},{"term":"2020-06-08","count":885},{"term":"2020-06-09","count":702},{"term":"2020-06-10","count":735},{"term":"2020-06-11","count":1007},{"term":"2020-06-12","count":867},{"term":"2020-06-13","count":729},{"term":"2020-06-14","count":593},{"term":"2020-06-15","count":1126},{"term":"2020-06-16","count":1098},{"term":"2020-06-17","count":987},{"term":"2020-06-18","count":960},{"term":"2020-06-19","count":983},{"term":"2020-06-20","count":577},{"term":"2020-06-21","count":600},{"term":"2020-06-22","count":954},{"term":"2020-06-23","count":864},{"term":"2020-06-24","count":961},{"term":"2020-06-25","count":896},{"term":"2020-06-26","count":787},{"term":"2020-06-27","count":498},{"term":"2020-06-28","count":429},{"term":"2020-06-29","count":1068},{"term":"2020-06-30","count":996},{"term":"2020-07-01","count":921},{"term":"2020-07-02","count":976},{"term":"2020-07-03","count":824},{"term":"2020-07-04","count":578},{"term":"2020-07-05","count":418},{"term":"2020-07-06","count":908},{"term":"2020-07-07","count":775},{"term":"2020-07-08","count":827},{"term":"2020-07-09","count":695},{"term":"2020-07-10","count":794},{"term":"2020-07-11","count":392},{"term":"2020-07-12","count":312},{"term":"2020-07-13","count":761},{"term":"2020-07-14","count":744},{"term":"2020-07-15","count":795},{"term":"2020-07-16","count":746},{"term":"2020-07-17","count":775},{"term":"2020-07-18","count":688},{"term":"2020-07-19","count":469},{"term":"2020-07-20","count":813},{"term":"2020-07-21","count":810},{"term":"2020-07-22","count":735},{"term":"2020-07-23","count":794},{"term":"2020-07-24","count":741},{"term":"2020-07-25","count":481},{"term":"2020-07-26","count":344},{"term":"2020-07-27","count":1029},{"term":"2020-07-28","count":693},{"term":"2020-07-29","count":724},{"term":"2020-07-30","count":686},{"term":"2020-07-31","count":596},{"term":"2020-08-01","count":564},{"term":"2020-08-02","count":493},{"term":"2020-08-03","count":886},{"term":"2020-08-04","count":727},{"term":"2020-08-05","count":708},{"term":"2020-08-06","count":842},{"term":"2020-08-07","count":639},{"term":"2020-08-08","count":446},{"term":"2020-08-09","count":470},{"term":"2020-08-10","count":1299},{"term":"2020-08-11","count":882},{"term":"2020-08-12","count":762},{"term":"2020-08-13","count":793},{"term":"2020-08-14","count":828},{"term":"2020-08-15","count":486},{"term":"2020-08-16","count":398},{"term":"2020-08-17","count":1425},{"term":"2020-08-18","count":929},{"term":"2020-08-19","count":792},{"term":"2020-08-20","count":947},{"term":"2020-08-21","count":818},{"term":"2020-08-22","count":385},{"term":"2020-08-23","count":315},{"term":"2020-08-24","count":1100},{"term":"2020-08-25","count":763},{"term":"2020-08-26","count":892},{"term":"2020-08-27","count":838},{"term":"2020-08-28","count":775},{"term":"2020-08-29","count":501},{"term":"2020-08-30","count":624},{"term":"2020-08-31","count":1732},{"term":"2020-09-01","count":996},{"term":"2020-09-02","count":771},{"term":"2020-09-03","count":851},{"term":"2020-09-04","count":752},{"term":"2020-09-05","count":381},{"term":"2020-09-06","count":250},{"term":"2020-09-07","count":1102},{"term":"2020-09-08","count":673},{"term":"2020-09-09","count":1194},{"term":"2020-09-10","count":1617},{"term":"2020-09-11","count":760},{"term":"2020-09-12","count":260},{"term":"2020-09-13","count":257},{"term":"2020-09-14","count":1495},{"term":"2020-09-15","count":688},{"term":"2020-09-16","count":1701},{"term":"2020-09-17","count":805},{"term":"2020-09-18","count":997},{"term":"2020-09-19","count":596},{"term":"2020-09-20","count":666},{"term":"2020-09-21","count":2316},{"term":"2020-09-22","count":887},{"term":"2020-09-23","count":961},{"term":"2020-09-24","count":2232},{"term":"2020-09-25","count":1107},{"term":"2020-09-26","count":438},{"term":"2020-09-27","count":970},{"term":"2020-09-28","count":1070},{"term":"2020-09-29","count":880},{"term":"2020-09-30","count":985},{"term":"2020-10-01","count":1900},{"term":"2020-10-02","count":1092},{"term":"2020-10-03","count":930},{"term":"2020-10-04","count":562},{"term":"2020-10-05","count":2452},{"term":"2020-10-06","count":1852},{"term":"2020-10-07","count":1801},{"term":"2020-10-08","count":1427},{"term":"2020-10-09","count":1350},{"term":"2020-10-10","count":678},{"term":"2020-10-11","count":924},{"term":"2020-10-12","count":2961},{"term":"2020-10-13","count":1236},{"term":"2020-10-14","count":1612},{"term":"2020-10-15","count":2287},{"term":"2020-10-16","count":1273},{"term":"2020-10-17","count":1007},{"term":"2020-10-18","count":719},{"term":"2020-10-19","count":1981},{"term":"2020-10-20","count":1892},{"term":"2020-10-21","count":2742},{"term":"2020-10-22","count":2592},{"term":"2020-10-23","count":1225},{"term":"2020-10-24","count":1251},{"term":"2020-10-25","count":611},{"term":"2020-10-26","count":3762},{"term":"2020-10-27","count":1416},{"term":"2020-10-28","count":807},{"term":"2020-10-29","count":1626},{"term":"2020-10-30","count":1690},{"term":"2020-10-31","count":774},{"term":"2020-11-01","count":1970},{"term":"2020-11-02","count":4307},{"term":"2020-11-03","count":1448},{"term":"2020-11-04","count":2055},{"term":"2020-11-05","count":2001},{"term":"2020-11-06","count":1436},{"term":"2020-11-07","count":1131},{"term":"2020-11-08","count":2152},{"term":"2020-11-09","count":2858},{"term":"2020-11-10","count":1382},{"term":"2020-11-11","count":1992},{"term":"2020-11-12","count":2297},{"term":"2020-11-13","count":2336},{"term":"2020-11-14","count":2524},{"term":"2020-11-15","count":1230},{"term":"2020-11-16","count":2502},{"term":"2020-11-17","count":1601},{"term":"2020-11-18","count":2537},{"term":"2020-11-19","count":1024},{"term":"2020-11-20","count":1508},{"term":"2020-11-21","count":928},{"term":"2020-11-22","count":1244},{"term":"2020-11-23","count":3065},{"term":"2020-11-24","count":1845},{"term":"2020-11-25","count":1208},{"term":"2020-11-26","count":971},{"term":"2020-11-27","count":1144},{"term":"2020-11-28","count":634},{"term":"2020-11-29","count":637},{"term":"2020-11-30","count":3152},{"term":"2020-12-01","count":990},{"term":"2020-12-02","count":1120},{"term":"2020-12-03","count":1091},{"term":"2020-12-04","count":964},{"term":"2020-12-05","count":633},{"term":"2020-12-06","count":853},{"term":"2020-12-07","count":3958},{"term":"2020-12-08","count":1117},{"term":"2020-12-09","count":1209},{"term":"2020-12-10","count":2634},{"term":"2020-12-11","count":1990},{"term":"2020-12-12","count":1257},{"term":"2020-12-13","count":1418},{"term":"2020-12-14","count":5278},{"term":"2020-12-15","count":2125},{"term":"2020-12-16","count":2014},{"term":"2020-12-17","count":2327},{"term":"2020-12-18","count":2213},{"term":"2020-12-19","count":1476},{"term":"2020-12-20","count":1511},{"term":"2020-12-21","count":4813},{"term":"2020-12-22","count":1252},{"term":"2020-12-23","count":1067},{"term":"2020-12-24","count":1102},{"term":"2020-12-25","count":582},{"term":"2020-12-26","count":1761},{"term":"2020-12-27","count":1527},{"term":"2020-12-28","count":4352},{"term":"2020-12-29","count":2260},{"term":"2020-12-30","count":1421},{"term":"2020-12-31","count":1459},{"term":"2021-01-01","count":614},{"term":"2021-01-02","count":1925},{"term":"2021-01-03","count":1524},{"term":"2021-01-04","count":4680},{"term":"2021-01-05","count":1475},{"term":"2021-01-06","count":975},{"term":"2021-01-07","count":733},{"term":"2021-01-08","count":996},{"term":"2021-01-09","count":1039},{"term":"2021-01-10","count":439},{"term":"2021-01-11","count":1614},{"term":"2021-01-12","count":56},{"term":"2021-01-13","count":27},{"term":"2021-01-14","count":4},{"term":"2021-01-15","count":7},{"term":"2021-01-16","count":1}]

const all_us = [{"term":"2020-01-19","count":2},{"term":"2020-01-22","count":2},{"term":"2020-01-23","count":1},{"term":"2020-01-25","count":2},{"term":"2020-01-27","count":1},{"term":"2020-01-28","count":1},{"term":"2020-01-29","count":4},{"term":"2020-01-31","count":1},{"term":"2020-02-06","count":1},{"term":"2020-02-10","count":1},{"term":"2020-02-11","count":1},{"term":"2020-02-17","count":8},{"term":"2020-02-18","count":6},{"term":"2020-02-20","count":2},{"term":"2020-02-21","count":7},{"term":"2020-02-22","count":3},{"term":"2020-02-23","count":1},{"term":"2020-02-24","count":7},{"term":"2020-02-25","count":2},{"term":"2020-02-26","count":6},{"term":"2020-02-27","count":9},{"term":"2020-02-28","count":24},{"term":"2020-02-29","count":37},{"term":"2020-03-01","count":25},{"term":"2020-03-02","count":44},{"term":"2020-03-03","count":41},{"term":"2020-03-04","count":67},{"term":"2020-03-05","count":97},{"term":"2020-03-06","count":79},{"term":"2020-03-07","count":84},{"term":"2020-03-08","count":91},{"term":"2020-03-09","count":149},{"term":"2020-03-10","count":145},{"term":"2020-03-11","count":178},{"term":"2020-03-12","count":313},{"term":"2020-03-13","count":496},{"term":"2020-03-14","count":484},{"term":"2020-03-15","count":727},{"term":"2020-03-16","count":867},{"term":"2020-03-17","count":738},{"term":"2020-03-18","count":778},{"term":"2020-03-19","count":613},{"term":"2020-03-20","count":516},{"term":"2020-03-21","count":386},{"term":"2020-03-22","count":312},{"term":"2020-03-23","count":507},{"term":"2020-03-24","count":541},{"term":"2020-03-25","count":556},{"term":"2020-03-26","count":536},{"term":"2020-03-27","count":545},{"term":"2020-03-28","count":397},{"term":"2020-03-29","count":278},{"term":"2020-03-30","count":591},{"term":"2020-03-31","count":546},{"term":"2020-04-01","count":661},{"term":"2020-04-02","count":563},{"term":"2020-04-03","count":597},{"term":"2020-04-04","count":348},{"term":"2020-04-05","count":224},{"term":"2020-04-06","count":506},{"term":"2020-04-07","count":392},{"term":"2020-04-08","count":439},{"term":"2020-04-09","count":321},{"term":"2020-04-10","count":371},{"term":"2020-04-11","count":270},{"term":"2020-04-12","count":144},{"term":"2020-04-13","count":543},{"term":"2020-04-14","count":324},{"term":"2020-04-15","count":359},{"term":"2020-04-16","count":283},{"term":"2020-04-17","count":267},{"term":"2020-04-18","count":211},{"term":"2020-04-19","count":118},{"term":"2020-04-20","count":366},{"term":"2020-04-21","count":339},{"term":"2020-04-22","count":301},{"term":"2020-04-23","count":317},{"term":"2020-04-24","count":311},{"term":"2020-04-25","count":163},{"term":"2020-04-26","count":117},{"term":"2020-04-27","count":360},{"term":"2020-04-28","count":309},{"term":"2020-04-29","count":434},{"term":"2020-04-30","count":486},{"term":"2020-05-01","count":398},{"term":"2020-05-02","count":203},{"term":"2020-05-03","count":111},{"term":"2020-05-04","count":376},{"term":"2020-05-05","count":256},{"term":"2020-05-06","count":237},{"term":"2020-05-07","count":248},{"term":"2020-05-08","count":257},{"term":"2020-05-09","count":170},{"term":"2020-05-10","count":53},{"term":"2020-05-11","count":277},{"term":"2020-05-12","count":319},{"term":"2020-05-13","count":364},{"term":"2020-05-14","count":454},{"term":"2020-05-15","count":298},{"term":"2020-05-16","count":111},{"term":"2020-05-17","count":77},{"term":"2020-05-18","count":276},{"term":"2020-05-19","count":240},{"term":"2020-05-20","count":250},{"term":"2020-05-21","count":259},{"term":"2020-05-22","count":268},{"term":"2020-05-23","count":93},{"term":"2020-05-24","count":82},{"term":"2020-05-25","count":101},{"term":"2020-05-26","count":333},{"term":"2020-05-27","count":277},{"term":"2020-05-28","count":188},{"term":"2020-05-29","count":271},{"term":"2020-05-30","count":129},{"term":"2020-05-31","count":120},{"term":"2020-06-01","count":276},{"term":"2020-06-02","count":239},{"term":"2020-06-03","count":290},{"term":"2020-06-04","count":261},{"term":"2020-06-05","count":256},{"term":"2020-06-06","count":89},{"term":"2020-06-07","count":81},{"term":"2020-06-08","count":326},{"term":"2020-06-09","count":230},{"term":"2020-06-10","count":218},{"term":"2020-06-11","count":259},{"term":"2020-06-12","count":195},{"term":"2020-06-13","count":242},{"term":"2020-06-14","count":136},{"term":"2020-06-15","count":451},{"term":"2020-06-16","count":480},{"term":"2020-06-17","count":322},{"term":"2020-06-18","count":435},{"term":"2020-06-19","count":458},{"term":"2020-06-20","count":254},{"term":"2020-06-21","count":327},{"term":"2020-06-22","count":596},{"term":"2020-06-23","count":407},{"term":"2020-06-24","count":514},{"term":"2020-06-25","count":445},{"term":"2020-06-26","count":469},{"term":"2020-06-27","count":224},{"term":"2020-06-28","count":235},{"term":"2020-06-29","count":629},{"term":"2020-06-30","count":512},{"term":"2020-07-01","count":469},{"term":"2020-07-02","count":447},{"term":"2020-07-03","count":369},{"term":"2020-07-04","count":205},{"term":"2020-07-05","count":192},{"term":"2020-07-06","count":464},{"term":"2020-07-07","count":435},{"term":"2020-07-08","count":490},{"term":"2020-07-09","count":438},{"term":"2020-07-10","count":441},{"term":"2020-07-11","count":103},{"term":"2020-07-12","count":81},{"term":"2020-07-13","count":186},{"term":"2020-07-14","count":218},{"term":"2020-07-15","count":188},{"term":"2020-07-16","count":196},{"term":"2020-07-17","count":207},{"term":"2020-07-18","count":140},{"term":"2020-07-19","count":110},{"term":"2020-07-20","count":168},{"term":"2020-07-21","count":170},{"term":"2020-07-22","count":164},{"term":"2020-07-23","count":147},{"term":"2020-07-24","count":149},{"term":"2020-07-25","count":79},{"term":"2020-07-26","count":75},{"term":"2020-07-27","count":238},{"term":"2020-07-28","count":173},{"term":"2020-07-29","count":134},{"term":"2020-07-30","count":149},{"term":"2020-07-31","count":138},{"term":"2020-08-01","count":129},{"term":"2020-08-02","count":39},{"term":"2020-08-03","count":250},{"term":"2020-08-04","count":165},{"term":"2020-08-05","count":192},{"term":"2020-08-06","count":200},{"term":"2020-08-07","count":150},{"term":"2020-08-08","count":115},{"term":"2020-08-09","count":84},{"term":"2020-08-10","count":224},{"term":"2020-08-11","count":250},{"term":"2020-08-12","count":155},{"term":"2020-08-13","count":180},{"term":"2020-08-14","count":257},{"term":"2020-08-15","count":139},{"term":"2020-08-16","count":124},{"term":"2020-08-17","count":401},{"term":"2020-08-18","count":287},{"term":"2020-08-19","count":253},{"term":"2020-08-20","count":216},{"term":"2020-08-21","count":203},{"term":"2020-08-22","count":154},{"term":"2020-08-23","count":57},{"term":"2020-08-24","count":237},{"term":"2020-08-25","count":217},{"term":"2020-08-26","count":185},{"term":"2020-08-27","count":182},{"term":"2020-08-28","count":194},{"term":"2020-08-29","count":110},{"term":"2020-08-30","count":60},{"term":"2020-08-31","count":258},{"term":"2020-09-01","count":224},{"term":"2020-09-02","count":236},{"term":"2020-09-03","count":245},{"term":"2020-09-04","count":193},{"term":"2020-09-05","count":78},{"term":"2020-09-06","count":48},{"term":"2020-09-07","count":57},{"term":"2020-09-08","count":182},{"term":"2020-09-09","count":249},{"term":"2020-09-10","count":200},{"term":"2020-09-11","count":235},{"term":"2020-09-12","count":66},{"term":"2020-09-13","count":26},{"term":"2020-09-14","count":246},{"term":"2020-09-15","count":185},{"term":"2020-09-16","count":282},{"term":"2020-09-17","count":175},{"term":"2020-09-18","count":130},{"term":"2020-09-19","count":51},{"term":"2020-09-20","count":46},{"term":"2020-09-21","count":141},{"term":"2020-09-22","count":140},{"term":"2020-09-23","count":188},{"term":"2020-09-24","count":163},{"term":"2020-09-25","count":182},{"term":"2020-09-26","count":97},{"term":"2020-09-27","count":57},{"term":"2020-09-28","count":179},{"term":"2020-09-29","count":154},{"term":"2020-09-30","count":174},{"term":"2020-10-01","count":208},{"term":"2020-10-02","count":206},{"term":"2020-10-03","count":73},{"term":"2020-10-04","count":96},{"term":"2020-10-05","count":334},{"term":"2020-10-06","count":238},{"term":"2020-10-07","count":232},{"term":"2020-10-08","count":226},{"term":"2020-10-09","count":201},{"term":"2020-10-10","count":77},{"term":"2020-10-11","count":91},{"term":"2020-10-12","count":279},{"term":"2020-10-13","count":225},{"term":"2020-10-14","count":228},{"term":"2020-10-15","count":280},{"term":"2020-10-16","count":234},{"term":"2020-10-17","count":104},{"term":"2020-10-18","count":104},{"term":"2020-10-19","count":327},{"term":"2020-10-20","count":274},{"term":"2020-10-21","count":294},{"term":"2020-10-22","count":282},{"term":"2020-10-23","count":217},{"term":"2020-10-24","count":105},{"term":"2020-10-25","count":69},{"term":"2020-10-26","count":312},{"term":"2020-10-27","count":257},{"term":"2020-10-28","count":240},{"term":"2020-10-29","count":210},{"term":"2020-10-30","count":234},{"term":"2020-10-31","count":90},{"term":"2020-11-01","count":79},{"term":"2020-11-02","count":317},{"term":"2020-11-03","count":218},{"term":"2020-11-04","count":295},{"term":"2020-11-05","count":235},{"term":"2020-11-06","count":189},{"term":"2020-11-07","count":111},{"term":"2020-11-08","count":55},{"term":"2020-11-09","count":288},{"term":"2020-11-10","count":275},{"term":"2020-11-11","count":167},{"term":"2020-11-12","count":224},{"term":"2020-11-13","count":238},{"term":"2020-11-14","count":143},{"term":"2020-11-15","count":128},{"term":"2020-11-16","count":441},{"term":"2020-11-17","count":408},{"term":"2020-11-18","count":431},{"term":"2020-11-19","count":341},{"term":"2020-11-20","count":373},{"term":"2020-11-21","count":110},{"term":"2020-11-22","count":122},{"term":"2020-11-23","count":443},{"term":"2020-11-24","count":366},{"term":"2020-11-25","count":317},{"term":"2020-11-26","count":72},{"term":"2020-11-27","count":220},{"term":"2020-11-28","count":125},{"term":"2020-11-29","count":179},{"term":"2020-11-30","count":624},{"term":"2020-12-01","count":355},{"term":"2020-12-02","count":410},{"term":"2020-12-03","count":253},{"term":"2020-12-04","count":247},{"term":"2020-12-05","count":53},{"term":"2020-12-06","count":36},{"term":"2020-12-07","count":198},{"term":"2020-12-08","count":165},{"term":"2020-12-09","count":181},{"term":"2020-12-10","count":199},{"term":"2020-12-11","count":230},{"term":"2020-12-12","count":97},{"term":"2020-12-13","count":23},{"term":"2020-12-14","count":212},{"term":"2020-12-15","count":273},{"term":"2020-12-16","count":160},{"term":"2020-12-17","count":191},{"term":"2020-12-18","count":157},{"term":"2020-12-19","count":122},{"term":"2020-12-20","count":209},{"term":"2020-12-21","count":231},{"term":"2020-12-22","count":77},{"term":"2020-12-23","count":106},{"term":"2020-12-24","count":97},{"term":"2020-12-25","count":33},{"term":"2020-12-26","count":320},{"term":"2020-12-27","count":188},{"term":"2020-12-28","count":381},{"term":"2020-12-29","count":307},{"term":"2020-12-30","count":291},{"term":"2020-12-31","count":233},{"term":"2021-01-01","count":36},{"term":"2021-01-02","count":194},{"term":"2021-01-03","count":164},{"term":"2021-01-04","count":465},{"term":"2021-01-05","count":303},{"term":"2021-01-06","count":383},{"term":"2021-01-07","count":216},{"term":"2021-01-08","count":146},{"term":"2021-01-09","count":36},{"term":"2021-01-10","count":7},{"term":"2021-01-11","count":31},{"term":"2021-01-12","count":1}]

export const ctry = [{"country":"Argentina","x":1,"n":92,"location_id":"Argentina","est":0.0109,"lower":0.0012,"upper":0.0497},{"country":"Australia","x":45,"n":773,"location_id":"Australia","est":0.0582,"lower":0.0433,"upper":0.0764},{"country":"Austria","x":42,"n":299,"location_id":"Austria","est":0.1405,"lower":0.1046,"upper":0.1832},{"country":"Belgium","x":86,"n":1383,"location_id":"Belgium","est":0.0622,"lower":0.0504,"upper":0.0758},{"country":"Brazil","x":5,"n":339,"location_id":"Brazil","est":0.0147,"lower":0.0056,"upper":0.032},{"country":"Canada","x":1,"n":819,"location_id":"Canada","est":0.0012,"lower":0.0001,"upper":0.0057},{"country":"Czech Republic","x":10,"n":199,"location_id":"CzechRepublic","est":0.0503,"lower":0.0261,"upper":0.0873},{"country":"Denmark","x":370,"n":26763,"location_id":"Denmark","est":0.0138,"lower":0.0125,"upper":0.0153},{"country":"Ecuador","x":4,"n":36,"location_id":"Ecuador","est":0.1111,"lower":0.0387,"upper":0.2429},{"country":"Finland","x":40,"n":571,"location_id":"Finland","est":0.0701,"lower":0.0513,"upper":0.0932},{"country":"France","x":30,"n":929,"location_id":"France","est":0.0323,"lower":0.0223,"upper":0.0452},{"country":"Germany","x":16,"n":1087,"location_id":"Germany","est":0.0147,"lower":0.0088,"upper":0.0232},{"country":"Greece","x":4,"n":6,"location_id":"Greece","est":0.6667,"lower":0.2864,"upper":0.9232},{"country":"Hong Kong","x":3,"n":57,"location_id":"HongKong","est":0.0526,"lower":0.015,"upper":0.1338},{"country":"Hungary","x":5,"n":115,"location_id":"Hungary","est":0.0435,"lower":0.0168,"upper":0.0927},{"country":"Iceland","x":21,"n":3121,"location_id":"Iceland","est":0.0067,"lower":0.0043,"upper":0.0101},{"country":"India","x":20,"n":162,"location_id":"India","est":0.1235,"lower":0.0796,"upper":0.1807},{"country":"Iran","x":1,"n":2,"location_id":"Iran","est":0.5,"lower":0.0608,"upper":0.9392},{"country":"Ireland","x":80,"n":604,"location_id":"Ireland","est":0.1325,"lower":0.1072,"upper":0.1612},{"country":"Israel","x":64,"n":395,"location_id":"Israel","est":0.162,"lower":0.1282,"upper":0.2008},{"country":"Italy","x":99,"n":983,"location_id":"Italy","est":0.1007,"lower":0.0831,"upper":0.1207},{"country":"Jamaica","x":4,"n":5,"location_id":"Jamaica","est":0.8,"lower":0.3714,"upper":0.9775},{"country":"Latvia","x":4,"n":50,"location_id":"Latvia","est":0.08,"lower":0.0276,"upper":0.1791},{"country":"Lebanon","x":1,"n":4,"location_id":"Lebanon","est":0.25,"lower":0.0285,"upper":0.7162},{"country":"Luxembourg","x":3,"n":1933,"location_id":"Luxembourg","est":0.0016,"lower":0.0004,"upper":0.0041},{"country":"Mexico","x":1,"n":30,"location_id":"Mexico","est":0.0333,"lower":0.0036,"upper":0.1454},{"country":"Netherlands","x":95,"n":2584,"location_id":"Netherlands","est":0.0368,"lower":0.03,"upper":0.0445},{"country":"New Zealand","x":17,"n":194,"location_id":"NewZealand","est":0.0876,"lower":0.0539,"upper":0.1335},{"country":"Norway","x":20,"n":754,"location_id":"Norway","est":0.0265,"lower":0.0168,"upper":0.0399},{"country":"Oman","x":1,"n":2,"location_id":"Oman","est":0.5,"lower":0.0608,"upper":0.9392},{"country":"Pakistan","x":2,"n":3,"location_id":"Pakistan","est":0.6667,"lower":0.1767,"upper":0.9613},{"country":"Peru","x":1,"n":132,"location_id":"Peru","est":0.0076,"lower":0.0008,"upper":0.0349},{"country":"Poland","x":1,"n":6,"location_id":"Poland","est":0.1667,"lower":0.0186,"upper":0.5581},{"country":"Portugal","x":73,"n":510,"location_id":"Portugal","est":0.1431,"lower":0.1148,"upper":0.1755},{"country":"Romania","x":1,"n":38,"location_id":"Romania","est":0.0263,"lower":0.0029,"upper":0.1165},{"country":"Singapore","x":18,"n":281,"location_id":"Singapore","est":0.0641,"lower":0.0398,"upper":0.0972},{"country":"Slovakia","x":22,"n":47,"location_id":"Slovakia","est":0.4681,"lower":0.3309,"upper":0.6091},{"country":"South Korea","x":13,"n":328,"location_id":"SouthKorea","est":0.0396,"lower":0.0224,"upper":0.0649},{"country":"Spain","x":109,"n":1454,"location_id":"Spain","est":0.075,"lower":0.0623,"upper":0.0894},{"country":"Sri Lanka","x":1,"n":32,"location_id":"SriLanka","est":0.0312,"lower":0.0034,"upper":0.1369},{"country":"Sweden","x":15,"n":431,"location_id":"Sweden","est":0.0348,"lower":0.0205,"upper":0.0553},{"country":"Switzerland","x":24,"n":3474,"location_id":"Switzerland","est":0.0069,"lower":0.0045,"upper":0.0101},{"country":"Turkey","x":21,"n":91,"location_id":"Turkey","est":0.2308,"lower":0.1535,"upper":0.3249},{"country":"United Kingdom","x":23249,"n":111759,"location_id":"UnitedKingdom","est":0.208,"lower":0.2057,"upper":0.2104},{"country":"United States","x":187,"n":23373,"location_id":"UnitedStatesofAmerica","est":0.008,"lower":0.0069,"upper":0.0092}]
export function getDates(scope) {
let x;
if(scope == "global"){
return(rollingAverage(b117_global, all_global))
}
return(rollingAverage(b117_us, all_us))
}


export function getCuratedMetadata(id) {
  return from(
    axios.get(curatedFile, {
      headers: {
        "Content-Type": "application/json"
      }
    })
  ).pipe(
    pluck("data"),
    map(results => {
      const curated = results.filter(d => d.identifier == id);
      if (curated.length === 1) {
        return (curated[0])
      } else {
        console.log("No reports or more than one report metadata found!")
      }
    }),
    // mergeMap(md => getLineageResources(apiUrl, md, 10, 1).pipe(
    //   map(resources => {
    //     resources["md"] = md;
    //     return(resources)
    //   })
    // )),
    catchError(e => {
      console.log("%c Error in getting curated data!", "color: red");
      console.log(e);
      return from([]);
    })
  )
}

export function getLineageResources(apiUrl, searchTerms, size, page, sort = "-date") {
  const fields = "@type, name, author, date, journalName"
  const queryString = `"${searchTerms.join('" OR "')}"`;
  const timestamp = Math.round(new Date().getTime() / 36e5);


  return from(
    axios.get(`${apiUrl}query?q=${queryString}&sort=${sort}&size=${size}&from=${page}&fields=${fields}&timestamp=${timestamp}`, {
      headers: {
        "Content-Type": "application/json"
      }
    })
  ).pipe(
    pluck("data"),
    map(results => {
      const formatDate = timeFormat("%e %B %Y");
      const parseDate = timeParse("%Y-%m-%d");

      results["hits"].forEach(d => {
        const parsedDate = parseDate(d.date)
        d["dateFormatted"] = formatDate(parsedDate);
      })

      return({resources: results["hits"], total: results["total"] })
    }),
  catchError(e => {
    console.log("%c Error in getting resource metadata!", "color: red");
    console.log(e);
    return from([]);
  })
)

}
